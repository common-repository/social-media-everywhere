"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var i=0;i<t.length;i++){var o=t[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function _createClass(e,t,i){return t&&_defineProperties(e.prototype,t),i&&_defineProperties(e,i),e}var SocialMediaEverywherePopupUtil=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"isString",value:function(e){return"[object String]"===Object.prototype.toString.call(e)}},{key:"parseBoolean",value:function(t){return e.isString(t)?"true"===t:t}},{key:"lockScrolling",value:function(){var e=jQuery("html");e.data("previous-overflow",e.css("overflow")),e.css("overflow","hidden")}},{key:"unlockScrolling",value:function(){var e=jQuery("html");e.css("overflow",e.data("previous-overflow"))}},{key:"showPopup",value:function(){jQuery("#social-media-everywhere-modal").show(),e.lockScrolling()}},{key:"hidePopup",value:function(){jQuery("#social-media-everywhere-modal").hide(),e.unlockScrolling()}}]),e}(),SocialMediaEverywherePopupCongfiguration=function(){function e(){_classCallCheck(this,e)}return _createClass(e,[{key:"isBlogPost",value:function(){return SME.global.isPost}},{key:"isPopupEnabled",value:function(){return SME.popup.enabled}},{key:"isBottomPopupEnabled",value:function(){return SME.popup.bottomPopupEnabled}},{key:"isTimedPopupEnabled",value:function(){return SME.popup.timedPopupEnabled}},{key:"getTimedPopupMillisecs",value:function(){return 1e3*SME.popup.timedPopupSeconds}},{key:"getPopupExpirationInMillisec",value:function(){return 1e3*SME.popup.expirationTimeInSeconds}}]),e}(),SocialMediaEverywherePopupStorage=function(){function e(){_classCallCheck(this,e),this.isStorageAvailable="undefined"!=typeof Storage}return _createClass(e,[{key:"get",value:function(e){return this.isStorageAvailable?localStorage.getItem(e):jQuery("html").data(e)}},{key:"exists",value:function(e){var t=this.get(e);return void 0!==t&&null!==t}},{key:"getBoolean",value:function(e){return SocialMediaEverywherePopupUtil.parseBoolean(this.get(e))}},{key:"set",value:function(e,t){this.isStorageAvailable?localStorage.setItem(e,t):jQuery("html").data(e,t)}}]),e}(),SocialMediaEverywherePopupStateValue=function(){function e(t,i){_classCallCheck(this,e),this.alreadyShown=t,this.createdAt=i}return _createClass(e,[{key:"toJSONString",value:function(){return JSON.stringify({alreadyShown:this.alreadyShown,createdAt:this.createdAt})}}],[{key:"fromJSONString",value:function(t){var i=JSON.parse(t);return new e(i.alreadyShown,i.createdAt)}}]),e}(),SocialMediaEverywherePopupState=function(){function e(t,i){_classCallCheck(this,e),this.config=t,this.storage=i,this.POPUP_ALREADY_SHOWN="social-media-everywhere-popup-shown"}return _createClass(e,[{key:"calculateCreatedAt",value:function(){return(new Date).getTime()}},{key:"initializePopupAlreadyShown",value:function(){this.storage.set(this.POPUP_ALREADY_SHOWN,new SocialMediaEverywherePopupStateValue(!1,this.calculateCreatedAt()).toJSONString())}},{key:"setPopupAlreadyShown",value:function(){this.storage.set(this.POPUP_ALREADY_SHOWN,new SocialMediaEverywherePopupStateValue(!0,this.calculateCreatedAt()).toJSONString())}},{key:"isPopupAlreadyShown",value:function(){return SocialMediaEverywherePopupStateValue.fromJSONString(this.storage.get(this.POPUP_ALREADY_SHOWN)).alreadyShown}},{key:"expirePopupAlreadyShownIfNecessary",value:function(){var e=SocialMediaEverywherePopupStateValue.fromJSONString(this.storage.get(this.POPUP_ALREADY_SHOWN));if(e.alreadyShown){var t=e.createdAt;(new Date).getTime()>t+this.config.getPopupExpirationInMillisec()&&this.initializePopupAlreadyShown()}}}]),e}(),SocialMediaEverywhereBottomPopup=function(){function e(t){_classCallCheck(this,e),this.settings=t}return _createClass(e,[{key:"initialize",value:function(){var e=this;this.showPopupIfNecessary(),jQuery(window).scroll(function(){return e.showPopupIfNecessary()})}},{key:"showPopupIfNecessary",value:function(){if(!this.settings.isPopupAlreadyShown()){var e=jQuery("#sme-post-bottom").offset().top,t=jQuery("#sme-post-bottom").outerHeight(),i=jQuery(window).height(),o=jQuery(window).scrollTop();o>e+t-i&&e>o&&o+i>e+t&&(this.settings.setPopupAlreadyShown(!0),SocialMediaEverywherePopupUtil.showPopup())}}}]),e}(),SocialMediaEverywhereTimedPopup=function(){function e(t,i){_classCallCheck(this,e),this.state=t,this.config=i}return _createClass(e,[{key:"initialize",value:function(){var e=this;setTimeout(function(){return e.showPopupIfNecessary()},this.config.getTimedPopupMillisecs())}},{key:"showPopupIfNecessary",value:function(){this.state.isPopupAlreadyShown()||(this.state.setPopupAlreadyShown(!0),SocialMediaEverywherePopupUtil.showPopup())}}]),e}();jQuery(document).ready(function(e){var t=new SocialMediaEverywherePopupCongfiguration;if(t.isBlogPost()&&t.isPopupEnabled()){var i=new SocialMediaEverywherePopupStorage,o=new SocialMediaEverywherePopupState(t,i),a=new SocialMediaEverywhereBottomPopup(o),r=new SocialMediaEverywhereTimedPopup(o,t);i.exists(o.POPUP_ALREADY_SHOWN)||o.initializePopupAlreadyShown(),o.expirePopupAlreadyShownIfNecessary(),e(window).on("click",function(t){var i=e("#social-media-everywhere-modal");t.target==i[0]&&SocialMediaEverywherePopupUtil.hidePopup()}),t.isBottomPopupEnabled()?a.initialize():t.isTimedPopupEnabled()&&r.initialize()}});